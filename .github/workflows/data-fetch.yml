name: Download JSON Daily

on:
  # Runs every day at 13:00 UTC, which is 6:00 AM MST if MST is UTC-7
  schedule:
    - cron: '0 13 * * *'
  # Allows you to run the workflow manually from GitHub Actions tab
  workflow_dispatch:

jobs:
  download-json-file:
    runs-on: ubuntu-latest

    steps:
      - name: Check out repository
        uses: actions/checkout@v2

      - name: Download Satellite JSON
        run: |
          curl -L 'https://www.space-track.org/basicspacedata/query/class/gp/decay_date/null-val/epoch/%3Enow-30/orderby/norad_cat_id/format/json' \
            --output apps/orbital-eye/public/data/satellite-gp.json

      - name: Download Conjunction JSON
        run: |
          curl -L 'https://www.space-track.org/basicspacedata/query/class/cdm_public/format/json' \
            --output apps/orbital-eye/public/data/public-conjunction.json

      - name: Commit and push if changed
        run: |
          # Configure Git
          git config user.name "github-actions"
          git config user.email "[emailÂ protected]"

          # Stage the files
          git add apps/orbital-eye/public/data/satellite-gp.json
          git add apps/orbital-eye/public/data/public-conjunction.json

          # Only commit/push if there is a change
          if git diff --cached --quiet; then
            echo "No changes in data; skipping commit."
          else
            git commit -m "chore: update satellite-gp.json and public-conjunction.json"
            git push
          fi
